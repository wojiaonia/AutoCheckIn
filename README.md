## （2020年4月4日更新）不觉就毕业半年了，现在已经是上班狗，听说现在课题组内部打卡全部需要刷指纹和扫脸（这个扫脸不单单是仪器扫，导师还需要你按时出现在他办公室），so 新来的师弟师妹真的惨，祝他们学有所成，顺顺利利毕业！ 并不是说这脚本就没有意义了，起码在我那个“旧时代”还是给我带来很多优质睡眠滴（逃），姑且把这毫无规范的脚本留下，当一个纪念。回到根本，我搞这个脚本的初心是抗拒死板的打卡签到，并没有对科研和学术有丝毫的不礼貌。
# AutoCheckIn
这是安卓端代码，电脑端的脚本另外放置，请移步查看：[Python 脚本](https://github.com/wojiaonia/AutoCheckIn-PythonScript)

## Introduction
现在众多打卡软件应运而生，例如最出名的阿里钉钉，给很多人带来困扰。
作为一个研究生搬砖工，对导师购买了三方开发的打卡软件无法接受（一个月几百块时有时无的补贴还要我早起打卡，说实话不存在的）
早起是不会早起的，这辈子都不会早起的，叫别人代打又很麻烦，不要工资又做不到，只能搞个自动打卡这样子，才能维持得了优质睡眠。

## 摆脱打卡签到软件的思路
1. 打卡签到最核心的组件就是GPS定位模块，从这部分入手是最有效的，常用的工具有 虚拟定位精灵（不用root但容易卡死）、Daniu（需要root 但效果极好，因为权限足） 等等，通过这些软件在软件层达到截获GPS定位接口从而伪冒定位信息，实现随时随地异地打卡
2. 现在很多的新版的打卡软件已经增加了连接对应wifi才能打卡，定位必须 wifi 和 gps 双定位才能生效等等，这种可以通过伪造解决
3. 最简单的方法就是，淘一个几百块或者手头的二奶机，充着电放在办公室，再通过定时软件打开对应脚本执行打卡，这种方法是最简单最无解的，完美的实现人机分离，而且毫无漏洞

## 本软件的思路
1. 首先，导师买的软件不是 钉钉，是一个类似钉钉的软件（没错目测是学生团队开发的）
2. 通过伪造定位是可以完美实现打卡的了，但我人很懒，每天早醒起来打了卡再睡回去非常痛苦，所以我的思路为，二奶机放在办公室，脚本全自动打卡

## 遇到的问题和解决
1. 打卡软件是基于安卓的，打卡操作需要用到一些模拟点击啊，自动化的组件，在安卓上 Accessibility Service（就是大名鼎鼎的微信抢红包使用的组件），因此基于安卓平台开发一个accessibility service 服务
2. 该组件的开启需要管理员权限，因此二奶机root了，解决基本需求
3. 软件实现的逻辑是：
* 打开app
* 通过Accessibility service 执行一些输入点击操作
* 邮件通知

4. 在执行登录操作时，发现软件对密码输入框做了处理，accessibility service 的 accessible 属性为false，因此使用获取输入框控件再通过 ACTION_INPUT 无法输入，解决方法为使用最无解的模拟点击，点击密码框，聚焦后，通过逐个输入字符实现密码输入
5. 剩下的页面都存在一样的问题，例如window的控件的id是随机的并且不具有确定的id name，简直比钉钉还坑，一点也成熟的页面layout设计，因此都是采用 模拟点击实现页面切换
6. 最后的问题就是自动化，初始是通过安卓的 AlarmManager 来实现的，但问题很多：最主要的就是安卓手机的休眠机制，作为第三方软件，分分钟都存在被杀的可能，不利于长久稳定的自动打卡
   解决方法是：安卓端只实现打卡逻辑操作，定时逻辑操作通过电脑端计划任务来实现（事实摆在眼前，在window平台上，使用c# 或者系统自带的 计划任务 真的稳定高效，而且可以获取任何权限）
   最后的整体框架就是：win端设定定时任务，定时开关机，唤醒 ，执行python 脚本，脚本的功能就是通过 adb 命令启动安卓端打卡逻辑操作，测试结果显示，稳得一批
   
## 配置注意的问题
1. 就是win10 下计划任务的配置问题，配置错误，定时是不稳定的
   具体配置参考：https://jingyan.baidu.com/article/15622f2419ff79fdfcbea5db.html
   我觉得写得很好了，直接引用
2. 我也是第一次使用 android studio，心得就是尽量不要用最新版，我使用的是2.3.3 版本，保留了原版的monitor 连接手机非常方便。自己也是第一次使用安卓开发，之前只学过 python 和 javaweb，所以代码很多时候不够健壮不符合安卓规范，多多包涵
3. 代码里面所有的 模拟点击都是根据自己的三星note3 二奶机设定的，不同手机由于分辨率还有适配不同，要重新设定，另外也可以通过获取对应控件的 rect(x,y)
来定位 执行点击，我是通过打开手机自带的 设置-开发者选项-显示用户点击的轨迹和位置 来获取点击的想想x，y坐标点的
4. adb命令这里有大全，包学包会： [awesome adb tutorial](https://github.com/mzlogin/awesome-adb)
## 说在后面
1. 此版本已经是调试了一两周的，现在在我电脑和手机稳定运行，完美改善了我的睡眠
2. 除非这个打卡软件又更新了，恶心我，一般我不更新了
3. 各位大佬路过的可以给我意见啊，谢谢你们，我的邮箱： 953633450@qq.com
4. 其实还有很多好很多的思路，例如
* 结合人工智能框架：通过没进入一个页面就截图，模糊匹配识别当前页面，再执行相应操作
* 最暴力的方法，通过安卓截包，获取打卡请求的内容（可惜一般有复杂加密），再伪造对应请求就行了
* 大神们有人通过 反编译，反向工程来破解的，那真是大哥对不起
* 卡是不可能打的，钱是不会要的，随意，这是最高境界，希望我早日达到如此境界，我科室的一个大佬就是这样的，钱太多了，无视这点打卡扣钱的问题  
   
